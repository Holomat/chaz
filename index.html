<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEC | Editorial Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-page: #FFFFFF;
            --sidebar-bg: #FFFFFF;
            --accent: #007AFF;
            --text-main: #1D1D1F;
            --text-mute: #86868B;
            --input-bg: #F5F5F7;
            --border-color: #E5E5E7;
            --radius: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--bg-page); 
            height: 100vh; 
            display: flex; 
            color: var(--text-main); 
            overflow: hidden; 
        }
        
        /* SIDEBAR ESTILO NOTION/CLEAN */
        .sidebar { 
            width: 380px; 
            background: var(--sidebar-bg); 
            padding: 48px 40px; 
            display: flex; 
            flex-direction: column; 
            gap: 28px; 
            overflow-y: auto; 
            border-right: 1px solid var(--border-color);
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .sidebar::-webkit-scrollbar { display: none; }
        
        header { margin-bottom: 8px; }
        h2 { 
            font-family: 'Inter', sans-serif;
            font-size: 18px; 
            font-weight: 700; 
            letter-spacing: -0.02em;
            color: var(--text-main);
        }
        .tagline { 
            font-size: 11px; 
            color: var(--text-mute); 
            text-transform: uppercase; 
            letter-spacing: 0.05em; 
            font-weight: 600;
            margin-top: 2px;
        }
        
        /* FORMULARIOS REFINADOS */
        .form-group { display: flex; flex-direction: column; gap: 6px; }
        
        label { 
            font-size: 11px; 
            font-weight: 600; 
            color: var(--text-mute);
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }
        
        .ui-card {
            height: 42px;
            padding: 0 14px;
            border: 1px solid transparent;
            border-radius: var(--radius);
            background: var(--input-bg);
            display: flex;
            align-items: center;
            transition: all 0.2s ease;
            width: 100%;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: var(--text-main);
            appearance: none;
        }

        .ui-card:hover { background: #EBEBEF; }
        input[type="text"].ui-card:focus, select.ui-card:focus {
            outline: none;
            background: #FFFFFF;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        select.ui-card {
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' fill='none' stroke='%2386868b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m2 3 3 3 3-3'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
        }

        .file-label { 
            background: var(--text-main); 
            color: #FFFFFF; 
            cursor: pointer; 
            justify-content: center; 
            font-weight: 500; 
            font-size: 13px;
        }
        .file-label:hover { background: #000; transform: translateY(-1px); }

        /* SLIDER APPLE STYLE */
        .scale-slider {
            -webkit-appearance: none; width: 100%; height: 4px;
            background: #D2D2D7; border-radius: 2px; outline: none;
        }
        .scale-slider::-webkit-slider-thumb {
            -webkit-appearance: none; width: 18px; height: 18px;
            background: #FFFFFF; border: 0.5px solid rgba(0,0,0,0.1);
            border-radius: 50%; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }

        /* PALETA DE COLOR */
        .color-row { width: 100%; display: flex; justify-content: space-between; align-items: center; }
        .color-dot { 
            width: 22px; height: 22px; border-radius: 50%; cursor: pointer; 
            transition: transform 0.2s; border: 2px solid transparent; 
            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05);
        }
        .color-dot.active { border-color: var(--text-main); transform: scale(1.1); }

        .download-btn { 
            background: var(--accent); color: white; border: none; 
            height: 48px; min-height: 48px; border-radius: var(--radius); 
            font-weight: 600; font-size: 14px; cursor: pointer; 
            margin-top: 10px; transition: all 0.2s;
        }
        .download-btn:hover { background: #0066D6; box-shadow: 0 4px 12px rgba(0,122,255,0.2); }

        /* AREA DE TRABAJO */
        .canvas-container { 
            flex: 1; display: flex; align-items: center; justify-content: center; 
            padding: 40px; background: #FBFBFB; 
        }

        .poster { 
            width: 540px; height: 675px; background: #FFFFFF; position: relative; 
            overflow: hidden; border-radius: 2px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.08);
        }

        #bgWrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: move; }
        #bgPreview { position: absolute; transform-origin: center center; pointer-events: none; }
        
        #logoContainer { position: absolute; left: 36px; bottom: 32px; width: 42px; z-index: 50; }
        .logo { width: 100%; height: auto; display: block; }

        .text-container { position: absolute; left: 40px; right: 58px; bottom: 88px; z-index: 40; pointer-events: none; display: flex; flex-direction: column; justify-content: flex-end; min-height: 200px; }
        .etiqueta, .subtitle { font-family: 'Sora'; font-size: 20px; font-weight: 400; letter-spacing: -0.04em; }
        .etiqueta { margin-bottom: 12px; text-transform: uppercase; }
        .title { font-family: 'Sora'; font-size: 40px; font-weight: 300; line-height: 0.95; white-space: pre-line; letter-spacing: -0.05em; }
        .title.has-subtitle { margin-bottom: 16px; }
        .bold-part { font-weight: 800 !important; }
    </style>
</head>
<body>

    <div class="sidebar">
        <header>
            <h2>MEC STUDIO</h2>
            <p class="tagline">Editorial Engine v2</p>
        </header>
        
        <div class="form-group">
            <label>Imagen de Fondo</label>
            <label for="bgInput" class="ui-card file-label">Cargar archivo</label>
            <input type="file" id="bgInput" accept="image/*" style="display: none;">
        </div>

        <div class="form-group">
            <label>Escala de imagen</label>
            <div class="ui-card" style="background: transparent; padding: 0;">
                <input type="range" id="scaleInput" class="scale-slider" min="0.1" max="3" step="0.01" value="1">
            </div>
        </div>

        <div class="form-group">
            <label>Categoría</label>
            <input type="text" id="etiquetaIn" class="ui-card" placeholder="Ej: Taller [Virtual]" spellcheck="false">
        </div>

        <div class="form-group">
            <label>Título Principal</label>
            <input type="text" id="titleIn" class="ui-card" placeholder="Ej: Dirección de [Educación]" spellcheck="false">
        </div>

        <div class="form-group">
            <label>Subtítulo / Bajada</label>
            <input type="text" id="subtitleIn" class="ui-card" placeholder="Opcional" spellcheck="false">
        </div>
        
        <div class="form-group">
            <label>Color tipográfico</label>
            <div class="ui-card" style="background: transparent; border: 1px solid var(--border-color);">
                <div class="color-row">
                    <div class="color-dot active" style="background: #E8E0FF;" data-color="#E8E0FF"></div>
                    <div class="color-dot" style="background: #FFD0EF;" data-color="#FFD0EF"></div>
                    <div class="color-dot" style="background: #D1FFC0;" data-color="#D1FFC0"></div>
                    <div class="color-dot" style="background: #D2FFE8;" data-color="#D2FFE8"></div>
                    <div class="color-dot" style="background: #DDFF9D;" data-color="#DDFF9D"></div>
                    <div class="color-dot" style="background: #C0FFCA;" data-color="#C0FFCA"></div>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label>Programa</label>
            <select id="programaIn" class="ui-card">
                <option value="">General</option>
                <option value="Cecap">Cecap</option>
                <option value="Pas">Pas</option>
                <option value="Pnec">Pnec</option>
                <option value="Cultura científica">Cultura científica</option>
                <option value="DNE" selected>DNE</option>
            </select>
        </div>

        <button class="download-btn" onclick="downloadPoster()">Descargar</button>
    </div>

    <div class="canvas-container">
        <div class="poster" id="posterArea">
            <div id="bgWrapper"><img id="bgPreview" src=""></div>
            <div id="logoContainer">
                <svg class="logo" viewBox="0 0 88 81" id="logoSvg">
                    <path d="M81.0034 17.2512V8H53.2558H44.0312V17.2512V26.5488V35.7907V45.0884V54.3396H53.2558H81.0034V45.0884H53.2558V35.7907H81.0034V26.5488H53.2558V17.2512H81.0034Z" fill="currentColor"/>
                    <path d="M20.9248 8C13.2393 8 7 14.248 7 21.9651C7 29.6822 13.23 35.9302 20.9248 35.9302C28.6196 35.9302 34.8497 29.6822 34.8497 21.9651C34.8497 14.248 28.6196 8 20.9248 8ZM20.9248 26.6325C18.3568 26.6325 16.2709 24.5406 16.2709 21.9651C16.2709 19.3896 18.3568 17.2977 20.9248 17.2977C23.4929 17.2977 25.5788 19.3896 25.5788 21.9651C25.5788 24.5406 23.4929 26.6325 20.9248 26.6325Z" fill="currentColor"/>
                    <path d="M34.8497 45.0977H7V54.4046H34.8497V45.0977Z" fill="currentColor"/>
                    <path d="M80.9907 63.6934H7V73.0003H80.9907V63.6934Z" fill="currentColor"/>
                </svg>
            </div>
            <div class="text-container" id="textContainer">
                <div class="etiqueta" id="etiquetaShow"></div>
                <div class="title" id="titleShow"></div>
                <div class="subtitle" id="subtitleShow"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        const inputs = {
            etiqueta: document.getElementById('etiquetaIn'),
            title: document.getElementById('titleIn'),
            subtitle: document.getElementById('subtitleIn'),
            programa: document.getElementById('programaIn')
        };
        const logoSvg = document.getElementById('logoSvg');
        const textContainer = document.getElementById('textContainer');
        const scaleInput = document.getElementById('scaleInput');
        let currentColor = "#E8E0FF";
        let currentScale = 1;

        function processHTML(text) {
            return text.replace(/\[(.*?)\]/g, '<span class="bold-part">$1</span>');
        }

        function syncText() {
            let labelText = inputs.etiqueta.value;
            if(inputs.programa.value) labelText += ` | [${inputs.programa.value}]`;
            document.getElementById('etiquetaShow').innerHTML = processHTML(labelText);
            const hasSubtitle = inputs.subtitle.value.trim() !== "";
            const titleEl = document.getElementById('titleShow');
            titleEl.innerHTML = processHTML(inputs.title.value);
            if(hasSubtitle) titleEl.classList.add('has-subtitle');
            else titleEl.classList.remove('has-subtitle');
            document.getElementById('subtitleShow').innerHTML = processHTML(inputs.subtitle.value);
        }

        function applyGlobalColor(hex) {
            currentColor = hex;
            textContainer.style.color = hex;
            logoSvg.style.color = hex;
        }

        Object.values(inputs).forEach(input => input.oninput = syncText);
        inputs.programa.onchange = syncText;

        document.querySelectorAll('.color-dot').forEach(dot => {
            dot.addEventListener('click', () => {
                document.querySelector('.color-dot.active').classList.remove('active');
                dot.classList.add('active');
                applyGlobalColor(dot.dataset.color);
            });
        });

        const bgInput = document.getElementById('bgInput');
        const bgPreview = document.getElementById('bgPreview');
        const bgWrapper = document.getElementById('bgWrapper');
        let posX = 0, posY = 0, isDragging = false, startX, startY;

        function updateTransform() {
            bgPreview.style.transform = `translate(${posX}px, ${posY}px) scale(${currentScale})`;
        }

        bgInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                bgPreview.src = event.target.result;
                bgPreview.onload = () => {
                    const imgAspect = bgPreview.naturalWidth / bgPreview.naturalHeight;
                    if (imgAspect > (540/675)) { bgPreview.style.height = '675px'; bgPreview.style.width = 'auto'; }
                    else { bgPreview.style.width = '540px'; bgPreview.style.height = 'auto'; }
                    posX = 0; posY = 0; currentScale = 1; scaleInput.value = 1;
                    updateTransform();
                }
            };
            reader.readAsDataURL(file);
        });

        scaleInput.oninput = (e) => { currentScale = parseFloat(e.target.value); updateTransform(); };
        bgWrapper.onmousedown = (e) => { if(!bgPreview.src) return; isDragging = true; startX = e.clientX - posX; startY = e.clientY - posY; };
        window.onmousemove = (e) => { if (!isDragging) return; posX = e.clientX - startX; posY = e.clientY - startY; updateTransform(); };
        window.onmouseup = () => isDragging = false;

        async function downloadPoster() {
            const poster = document.getElementById('posterArea');
            const canvas = await html2canvas(poster, {
                scale: 3, useCORS: true, allowTaint: true, backgroundColor: "#FFFFFF",
                onclone: (clonedDoc) => { clonedDoc.getElementById('logoSvg').style.color = currentColor; }
            });
            const link = document.createElement('a');
            link.download = 'afiche-mec.png';
            link.href = canvas.toDataURL('image/png', 1.0);
            link.click();
        }

        inputs.etiqueta.value = "Taller [Virtual]";
        inputs.title.value = "Dirección Nacional de\n[Educación] 2026";
        inputs.subtitle.value = "Resumen de gestión a un año desde marzo a diciembre";
        applyGlobalColor(currentColor);
        syncText();
    </script>
</body>
</html>
